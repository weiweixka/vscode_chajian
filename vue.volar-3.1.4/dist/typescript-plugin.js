"use strict";const e=require(`./path-browserify-RqgFuIaq.js`),t=require(`./decorateLanguageServiceHost-PG7rPZUH.js`),n=require(`./language-core-YWG2VzwL.js`);var r=e.__commonJSMin(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.makeGetExternalFiles=exports.decoratedLanguageServiceHosts=exports.decoratedLanguageServices=exports.projectExternalFileExtensions=exports.externalFiles=void 0,exports.makeGetScriptInfoWithLargeFileFailsafe=a,exports.createLanguageCommon=o,exports.isHasAlreadyDecoratedLanguageService=l;let n=t.require_language_core$1(),r=t.require_common(),i=t.require_decorateLanguageServiceHost();exports.externalFiles=new WeakMap,exports.projectExternalFileExtensions=new WeakMap,exports.decoratedLanguageServices=new WeakSet,exports.decoratedLanguageServiceHosts=new WeakSet;function a(e){return t=>{try{return e.project.getScriptInfo(t)}catch{}}}function o(e,t,o,s){let c=o.languageServiceHost.getScriptSnapshot.bind(o.languageServiceHost),l=a(o),u=(0,n.createLanguage)([...e.languagePlugins,{getLanguageId:r.resolveFileLanguageId}],new n.FileMap(t.sys.useCaseSensitiveFileNames),(e,t,n)=>{let r;n?r=c(e):(r=l(e)?.getSnapshot(),r||(o.project.getScriptVersion(e),r=l(e)?.getSnapshot())),r?u.scripts.set(e,r):u.scripts.delete(e)},e=>{o.session.change({file:e,line:1,offset:1,endLine:1,endOffset:1,insertString:``})});s(u),(0,i.decorateLanguageServiceHost)(t,u,o.languageServiceHost),e.setup?.(u)}let s=t=>(n,r=0)=>{if(r>=1||!exports.externalFiles.has(n)){let r=exports.externalFiles.get(n),a=exports.projectExternalFileExtensions.get(n),o=a?.length?(0,i.searchExternalFiles)(t,n,a):[];exports.externalFiles.set(n,o),r&&!c(r,o)&&n.refreshDiagnostics()}return exports.externalFiles.get(n)};exports.makeGetExternalFiles=s;function c(e,t){if(e.length!==t.length)return!1;let n=new Set(e);for(let e of t)if(!n.has(e))return!1;return!0}function l(t){return exports.decoratedLanguageServices.has(t.languageService)||exports.decoratedLanguageServiceHosts.has(t.languageServiceHost)?!0:(exports.decoratedLanguageServices.add(t.languageService),exports.decoratedLanguageServiceHosts.add(t.languageServiceHost),!1)}}),i=e.__commonJSMin(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.createLanguageServicePlugin=a;let n=t.require_proxyLanguageService(),i=r();function a(e){return t=>{let{typescript:r}=t,a={create(t){if(!(0,i.isHasAlreadyDecoratedLanguageService)(t)){let a=e(r,t),o=a.languagePlugins.map(e=>e.typescript?.extraFileExtensions.map(e=>`.`+e.extension)??[]).flat();i.projectExternalFileExtensions.set(t.project,o);let{proxy:s,initialize:c}=(0,n.createProxyLanguageService)(t.languageService);t.languageService=s,(0,i.createLanguageCommon)(a,r,t,c)}return t.languageService},getExternalFiles:(0,i.makeGetExternalFiles)(r)};return a}}}),a=e.__commonJSMin(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.createVueLanguageServiceProxy=a;let t=n.require_language_core(),r=n.require_shared(),i=/\\/g;function a(e,t,n,r,i){let a=new Map,u=(n,a)=>{switch(a){case`getCompletionsAtPosition`:return o(e,t,i,r,n[a]);case`getCompletionEntryDetails`:return s(t,n[a]);case`getCodeFixesAtPosition`:return c(n[a]);case`getDefinitionAndBoundSpan`:return l(e,t,i,n[a])}};return new Proxy(n,{get(e,t,n){a.has(t)||a.set(t,u(e,t));let r=a.get(t);return r||Reflect.get(e,t,n)},set(e,t,n,r){return Reflect.set(e,t,n,r)}})}function o(e,n,a,o,s){return(c,l,u,d)=>{let f=c.replace(i,`/`),p=s(f,l,u,d);if(p){p.entries=p.entries.filter(e=>!e.name.includes(`__VLS_`)&&!e.labelDetails?.description?.includes(`__VLS_`));let i=n.scripts.get(a(f)),s=i?.generated?.root;if(s instanceof t.VueVirtualCode){let t=[s.sfc.template,...s.sfc.styles],n=t.filter(Boolean).map(e=>[e.startTagEnd,e.endTagStart]);if(n.some(([e,t])=>l>=e&&l<=t)){let t=new Set([`var`,`function`,`module`]),n=e.Completions.SortText.GlobalsOrKeywords,i=new Set([n,`z`+n,n+`1`]);p.entries=p.entries.filter(e=>!(e.kind===`const`&&e.name in o.macros)&&(!t.has(e.kind)||!i.has(e.sortText)||(0,r.isGloballyAllowed)(e.name)))}}for(let e of p.entries)if(e.source){let t=e.name;for(let n of o.extensions){let i=(0,r.capitalize)(n.slice(1));if(e.source.endsWith(n)&&e.name.endsWith(i)){e.name=(0,r.capitalize)(e.name.slice(0,-i.length)),e.insertText&&=e.insertText.replace(`${i}$1`,`$1`),e.data&&(e.data.__isComponentAutoImport={ext:n,suffix:i,originalName:t,newName:e.insertText});break}}e.data&&(e.data.__isAutoImport={fileName:f})}}return p}}function s(e,n){return(...r)=>{let i=n(...r);if(r[6]?.__isComponentAutoImport){let{originalName:e,newName:t}=r[6].__isComponentAutoImport;for(let n of i?.codeActions??[])for(let r of n.changes)for(let n of r.textChanges)n.newText=n.newText.replace(`import `+e+` from `,`import `+t+` from `)}if(r[6]?.__isAutoImport){let{fileName:n}=r[6].__isAutoImport,a=e.scripts.get(n);if(a?.generated?.root instanceof t.VueVirtualCode){let{vueSfc:e}=a.generated.root;if(!e?.descriptor.script&&!e?.descriptor.scriptSetup)for(let e of i?.codeActions??[]){for(let t of e.changes){for(let e of t.textChanges){e.newText=`<script setup lang="ts">${e.newText}</script>\n\n`;break}break}break}}}return i}}function c(e){return(...t)=>{let n=e(...t);return n=n.filter(e=>!e.description.includes(`__VLS_`)),n}}function l(e,n,r,i){return(a,o)=>{let s=i(a,o),c=n.scripts.get(r(a)),l=c?.generated?.root;if(!(l instanceof t.VueVirtualCode))return s;if(!s?.definitions?.length){let{template:t}=l.sfc;if(t){let n={start:t.start+1,length:8};if(o>=n.start&&o<=n.start+n.length)return{textSpan:n,definitions:[{fileName:a,textSpan:n,kind:e.ScriptElementKind.scriptElement,name:a,containerKind:e.ScriptElementKind.unknown,containerName:``}]}}return}if(!l.sfc.template||o<l.sfc.template.startTagEnd||o>l.sfc.template.endTagStart)return s;let u=new Set(s.definitions);if(s.definitions.length>=2)for(let e of s.definitions)(l.sfc.content[e.textSpan.start-1]===`@`||l.sfc.content.slice(e.textSpan.start-5,e.textSpan.start)===`v-on:`)&&u.delete(e);return{definitions:[...u],textSpan:s.textSpan}}}}),o=e.__commonJSMin(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.collectExtractProps=r;let t=n.require_language_core();function r(e,n,r,i,a,o,s=0){let c=new Map,l=r.getSourceFile(a.fileName),u=r.getTypeChecker(),d=i.generated.languagePlugin.typescript?.getServiceScript(a),f=d?[...n.maps.forEach(d.code)].map(([,e])=>e):[],{sfc:p}=a;return l.forEachChild(function n(r){if(e.isPropertyAccessExpression(r)&&e.isIdentifier(r.expression)&&r.expression.text===`__VLS_ctx`&&e.isIdentifier(r.name)){let{name:n}=r;for(let i of f){let a=!1;for(let l of i.toSourceLocation(n.getEnd()-s))if(l[0]>=p.template.startTagEnd+o[0]&&l[0]<=p.template.startTagEnd+o[1]&&(0,t.isSemanticTokensEnabled)(l[1].data)){if(a=!0,!c.has(n.text)){let t=u.getTypeAtLocation(r),i=u.typeToString(t,r,e.TypeFormatFlags.NoTruncation);c.set(n.text,{name:n.text,type:i.includes(`__VLS_`)?`any`:i,model:!1})}let t=e.isPostfixUnaryExpression(r.parent)||e.isBinaryExpression(r.parent);t&&(c.get(n.text).model=!0);break}if(a)break}}r.forEachChild(n)}),[...c.values()]}}),s=e.__commonJSMin(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.getComponentType=a,exports.getSelfComponentName=o,exports.getVariableType=s;let r=n.require_shared(),i=e.require_path_browserify();function a(e,t,n,i,a){let c=t.getTypeChecker(),l=a.split(`.`),u=i.type.getProperty(l[0])??i.type.getProperty((0,r.camelize)(l[0]))??i.type.getProperty((0,r.capitalize)((0,r.camelize)(l[0]))),d;if(u){d=c.getTypeOfSymbolAtLocation(u,i.node);for(let e=1;e<l.length;e++)u=d.getProperty(l[e]),u&&(d=c.getTypeOfSymbolAtLocation(u,i.node))}else{let i=o(n);i===(0,r.capitalize)((0,r.camelize)(a))&&(d=s(e,t,n,`__VLS_export`)?.type)}return d}function o(e){let t=i.basename(e);return(0,r.capitalize)((0,r.camelize)(t.slice(0,t.lastIndexOf(`.`))))}function s(e,t,n,r){let i=t.getSourceFile(n);if(i){let n=t.getTypeChecker(),a=c(e,i,r);if(a)return{node:a,type:n.getTypeAtLocation(a)}}}function c(e,t,n){let r;return i(t),r;function i(t){r||(e.isVariableDeclaration(t)&&t.name.getText()===n?r=t:t.forEachChild(i))}}}),c=e.__commonJSMin(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.getComponentDirectives=r;let t=s(),n=new Set([`vBind`,`vIf`,`vOn`,`vOnce`,`vShow`,`vSlot`]);function r(e,r,i){let a=(0,t.getVariableType)(e,r,i,`__VLS_directives`);return a?a.type.getProperties().map(({name:e})=>e).filter(e=>e.startsWith(`v`)&&e.length>=2&&e[1]===e[1].toUpperCase()).filter(e=>!n.has(e)):[]}}),l=e.__commonJSMin(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.getComponentEvents=n;let t=s();function n(e,n,r,i){let a=n.getTypeChecker(),o=(0,t.getVariableType)(e,n,r,`__VLS_components`);if(!o)return[];let s=(0,t.getComponentType)(e,n,r,o,i);if(!s)return[];let c=new Set;for(let e of s.getConstructSignatures()){let t=e.getReturnType(),n=t.getProperty(`$emit`);if(n){let e=a.getTypeOfSymbolAtLocation(n,o.node);for(let t of e.getCallSignatures())if(t.parameters.length){let e=t.parameters[0],n=a.getTypeOfSymbolAtLocation(e,o.node);n.isStringLiteral()&&c.add(n.value)}}}return[...c]}}),u=e.__commonJSMin(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.getComponentNames=n;let t=s();function n(e,n,r){let i=(0,t.getVariableType)(e,n,r,`__VLS_components`)?.type.getProperties().map(e=>e.name).filter(e=>!e.includes(`$`)&&!e.startsWith(`_`))??[];return i.push((0,t.getSelfComponentName)(r)),i}}),d=e.__commonJSMin(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.getComponentProps=n;let t=s();function n(e,n,i,a){let o=(0,t.getVariableType)(e,n,i,`__VLS_components`);if(!o)return[];let s=(0,t.getComponentType)(e,n,i,o,a);if(!s)return[];let c=new Map,l=n.getTypeChecker();for(let e of s.getCallSignatures())if(e.parameters.length){let t=e.parameters[0],n=l.getTypeOfSymbolAtLocation(t,o.node),r=n.getProperties();for(let e of r)u(e)}for(let e of s.getConstructSignatures()){let t=e.getReturnType(),n=t.getProperty(`$props`);if(n){let e=l.getTypeOfSymbolAtLocation(n,o.node),t=e.getProperties();for(let e of t)u(e)}}return[...c.values()];function u(t){if(t.flags&e.SymbolFlags.Method)return;let n=t.name,i=!(t.flags&e.SymbolFlags.Optional)||void 0,{documentation:a,deprecated:o}=r(t.getDocumentationComment(l),t.getJsDocTags()),s=[],u=l.getTypeOfSymbol(t),d=u.types;if(d)for(let e of d){let t=e.value;t&&s.push(t)}let f;for(let{parent:n}of l.getRootSymbols(t).flatMap(e=>e.declarations??[])){if(!e.isInterfaceDeclaration(n))continue;let{text:t}=n.name;if(t.endsWith(`HTMLAttributes`)||t===`AriaAttributes`||t===`SVGAttributes`){f=!0;break}}c.set(n,{name:n,required:i,deprecated:o,isAttribute:f,documentation:a,values:s})}}function r(e,t){let n=i(e),r=a(t),o=[n,r].filter(e=>!!e).join(`

`),s=t.some(e=>e.name===`deprecated`);return{documentation:o,deprecated:s}}function i(e){return e.map(e=>{switch(e.kind){case`keyword`:return`\`${e.text}\``;case`functionName`:return`**${e.text}**`;default:return e.text}}).join(``)}function a(e){return e.map(e=>{let t=`*@${e.name}*`,n=e.text?.map(e=>e.kind===`parameterName`?`\`${e.text}\``:e.text).join(``)||``;return`${t} ${n}`}).join(`

`)}}),f=e.__commonJSMin(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.getComponentSlots=i;let t=n.require_language_core(),r=s();function i(e,n,i){let a=t.tsCodegen.get(i.sfc);if(!a)return[];let o=a.getSetupSlotsAssignName()??`__VLS_slots`,s=(0,r.getVariableType)(e,n,i.fileName,o);return s?s.type.getProperties().map(({name:e})=>e):[]}}),p=e.__commonJSMin(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.getElementAttrs=t;function t(e,t,n){let r=t.getTypeChecker(),i=r.resolveName(`__VLS_intrinsics`,void 0,e.SymbolFlags.Variable,!1);if(!i)return[];let a=r.getTypeOfSymbol(i).getProperty(n);return a?r.getTypeOfSymbol(a).getProperties().map(e=>e.name):[]}}),m=e.__commonJSMin(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.getElementNames=t;function t(e,t){let n=t.getTypeChecker(),r=n.resolveName(`__VLS_intrinsics`,void 0,e.SymbolFlags.Variable,!1);return r?n.getTypeOfSymbol(r).getProperties().map(e=>e.name):[]}}),h=e.__commonJSMin(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.getImportPathForFile=t;function t(e,t,n,r,i,a){let o=n.getSourceFile(i),s=n.getSourceFile(r);if(!s||!o)return;let c=e.moduleSpecifiers.getModuleSpecifiersWithCacheInfo,l=e.createModuleSpecifierResolutionHost(n,t),{moduleSpecifiers:u}=c(o.symbol,n.getTypeChecker(),t.getCompilationSettings(),s,l,a);return u[0]}}),g=e.__commonJSMin(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.isRefAtPosition=r;let t=n.require_language_core();function r(e,n,r,i,a,o,s=0){let c=i.generated.languagePlugin.typescript?.getServiceScript(a);if(!c)return!1;let l=!1;for(let[e,r]of n.maps.forEach(c.code)){for(let[e,n]of r.toGeneratedLocation(o))if((0,t.isCompletionEnabled)(n.data)){o=e,l=!0;break}if(l)break}if(!l)return!1;let u=r.getSourceFile(a.fileName);if(!u)return!1;let d=h(u,u,o+s);if(!d)return!1;let f=r.getTypeChecker(),p=f.getTypeAtLocation(d),m=p.getProperties();return m.some(t=>t.declarations?.some(t=>e.isPropertySignature(t)&&e.isComputedPropertyName(t.name)&&e.isIdentifier(t.name.expression)&&t.name.expression.text===`RefSymbol`));function h(t,n,r){let i;return n.forEachChild(n=>{i||(n.end===r&&e.isIdentifier(n)?i=n:n.end>=r&&n.getStart(t)<r&&(i=h(t,n,r)))}),i}}});const _=i(),v=n.require_language_core(),y=a(),b=o(),x=c(),S=l(),C=u(),w=d(),T=f(),E=p(),D=m(),O=h(),k=g();module.exports=(0,_.createLanguageServicePlugin)((e,t)=>{let n=i(),r=v.createVueLanguagePlugin(e,t.languageServiceHost.getCompilationSettings(),n,e=>e);return n.globalTypesPath=v.createGlobalTypesWriter(n,e.sys.writeFile),a(),{languagePlugins:[r],setup:r=>{t.languageService=(0,y.createVueLanguageServiceProxy)(e,r,t.languageService,n,e=>e),t.project.__vue__={language:r}}};function i(){if(t.project.projectKind===e.server.ProjectKind.Configured){let n=t.project.getProjectName();return v.createParsedCommandLine(e,e.sys,n.replace(/\\/g,`/`)).vueOptions}else return v.createParsedCommandLineByJson(e,e.sys,t.languageServiceHost.getCurrentDirectory(),{}).vueOptions}function a(){let n=t.project.projectService;if(n.logger.info(`Vue: called handler processing `+t.project.projectKind),!t.session){n.logger.info(`Vue: there is no session in info.`);return}let r=t.session;if(!r.addProtocolHandler){n.logger.info(`Vue: there is no addProtocolHandler method.`);return}let i=r.handlers;if(i.has(`_vue:projectInfo`))return;r.addProtocolHandler(`_vue:projectInfo`,e=>i.get(`projectInfo`)(e)),r.addProtocolHandler(`_vue:documentHighlights-full`,e=>i.get(`documentHighlights-full`)(e)),r.addProtocolHandler(`_vue:encodedSemanticClassifications-full`,e=>i.get(`encodedSemanticClassifications-full`)(e)),r.addProtocolHandler(`_vue:quickinfo`,e=>i.get(`quickinfo`)(e)),r.addProtocolHandler(`_vue:collectExtractProps`,t=>{let[n,r]=t.arguments,{project:i,language:s,sourceScript:c,virtualCode:l}=o(n);return a((0,b.collectExtractProps)(e,s,i.getLanguageService().getProgram(),c,l,r,c.generated?c.snapshot.getLength():0))}),r.addProtocolHandler(`_vue:getImportPathForFile`,t=>{let[n,r,i]=t.arguments,{project:o}=s(n);return a((0,O.getImportPathForFile)(e,o,o.getLanguageService().getProgram(),n,r,i))}),r.addProtocolHandler(`_vue:isRefAtPosition`,t=>{let[n,r]=t.arguments,{project:i,language:s,sourceScript:c,virtualCode:l}=o(n);return a((0,k.isRefAtPosition)(e,s,i.getLanguageService().getProgram(),c,l,r,c.generated?c.snapshot.getLength():0))}),r.addProtocolHandler(`_vue:getComponentDirectives`,t=>{let[n]=t.arguments,{project:r}=s(n);return a((0,x.getComponentDirectives)(e,r.getLanguageService().getProgram(),n))}),r.addProtocolHandler(`_vue:getComponentEvents`,t=>{let[n,r]=t.arguments,{project:i}=s(n);return a((0,S.getComponentEvents)(e,i.getLanguageService().getProgram(),n,r))}),r.addProtocolHandler(`_vue:getComponentNames`,t=>{let[n]=t.arguments,{project:r}=s(n);return a((0,C.getComponentNames)(e,r.getLanguageService().getProgram(),n))}),r.addProtocolHandler(`_vue:getComponentProps`,t=>{let[n,r]=t.arguments,{project:i}=s(n);return a((0,w.getComponentProps)(e,i.getLanguageService().getProgram(),n,r))}),r.addProtocolHandler(`_vue:getComponentSlots`,t=>{let[n]=t.arguments,{project:r,virtualCode:i}=o(n);return a((0,T.getComponentSlots)(e,r.getLanguageService().getProgram(),i))}),r.addProtocolHandler(`_vue:getElementAttrs`,t=>{let[n,r]=t.arguments,{project:i}=s(n);return a((0,E.getElementAttrs)(e,i.getLanguageService().getProgram(),r))}),r.addProtocolHandler(`_vue:getElementNames`,t=>{let[n]=t.arguments,{project:r}=s(n);return a((0,D.getElementNames)(e,r.getLanguageService().getProgram()))}),n.logger.info(`Vue specific commands are successfully added.`);function a(e){return{response:e,responseRequired:!0}}function o(e){let t=s(e),n=t.language.scripts.get(e);if(!n)throw Error(`No source script found for file: `+e);let r=n.generated?.root;if(!(r instanceof v.VueVirtualCode))throw Error(`No virtual code found for file: `+e);return{...t,sourceScript:n,virtualCode:r}}function s(e){let{project:t}=r.getFileAndProject({file:e,projectFileName:void 0});if(!(`__vue__`in t))throw Error(`No vue project info for project: `+t.getProjectName());return{project:t,language:t.__vue__.language}}}});